<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…å•†é–€å¸‚åœ°åœ–æ•´åˆç¯„ä¾‹ - Taiwan Logistics Skill</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .store-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .store-info.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-row {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #667eea;
            min-width: 100px;
        }

        .info-value {
            color: #333;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .alert-success {
            background: #e8f5e9;
            color: #388e3c;
            border-left: 4px solid #388e3c;
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-ecpay {
            background: #ff9800;
            color: white;
        }

        .badge-newebpay {
            background: #2196f3;
            color: white;
        }

        .badge-payuni {
            background: #4caf50;
            color: white;
        }

        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸª è¶…å•†é–€å¸‚åœ°åœ–æ•´åˆç¯„ä¾‹</h1>
            <p>Taiwan Logistics Skill - Store Map Integration</p>
        </div>

        <div class="content">
            <div class="alert alert-info">
                <strong>ğŸ’¡ èªªæ˜:</strong> æ­¤ç¯„ä¾‹å±•ç¤ºå¦‚ä½•æ•´åˆè¶…å•†é–€å¸‚åœ°åœ–,è®“ä½¿ç”¨è€…é¸æ“‡å–è²¨é–€å¸‚ã€‚æ”¯æ´ ECPayã€NewebPayã€PAYUNi ä¸‰å®¶ç‰©æµæœå‹™å•†ã€‚
            </div>

            <div class="section">
                <div class="section-title">1. é¸æ“‡ç‰©æµæœå‹™å•†</div>
                <div class="form-group">
                    <label for="provider">ç‰©æµæœå‹™å•†</label>
                    <select id="provider">
                        <option value="ecpay">ECPay ç¶ ç•Œç‰©æµ <span class="badge badge-ecpay">MD5</span></option>
                        <option value="newebpay">NewebPay è—æ–°ç‰©æµ <span class="badge badge-newebpay">AES-256</span></option>
                        <option value="payuni">PAYUNi çµ±ä¸€ç‰©æµ <span class="badge badge-payuni">AES-GCM</span></option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="logisticsType">ç‰©æµé¡å‹</label>
                    <select id="logisticsType">
                        <option value="CVS">è¶…å•†å–è²¨</option>
                        <option value="Home">å®…é…åˆ°åºœ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="storeType">è¶…å•†é¡å‹</label>
                    <select id="storeType">
                        <option value="UNIMART">7-ELEVEN (çµ±ä¸€è¶…å•†)</option>
                        <option value="FAMI">FamilyMart (å…¨å®¶ä¾¿åˆ©å•†åº—)</option>
                        <option value="HILIFE">Hi-Life (èŠçˆ¾å¯Œ)</option>
                        <option value="OKMART">OK Mart (OK ä¾¿åˆ©å•†åº—)</option>
                    </select>
                </div>
            </div>

            <div class="section">
                <div class="section-title">2. è¨‚å–®è³‡è¨Š</div>
                <div class="form-group">
                    <label for="orderNo">è¨‚å–®ç·¨è™Ÿ</label>
                    <input type="text" id="orderNo" placeholder="ä¾‹: ORD20240130001" readonly>
                </div>

                <div class="form-group">
                    <label for="amount">è¨‚å–®é‡‘é¡ (å…ƒ)</label>
                    <input type="text" id="amount" placeholder="ä¾‹: 1200" value="1200">
                </div>
            </div>

            <div class="section">
                <div class="section-title">3. é–‹å•Ÿé–€å¸‚åœ°åœ–</div>
                <div class="button-group">
                    <button class="btn-primary" onclick="openStoreMap()">ğŸ—ºï¸ é¸æ“‡é–€å¸‚</button>
                    <button class="btn-secondary" onclick="resetForm()">ğŸ”„ é‡ç½®</button>
                </div>
            </div>

            <div id="storeInfo" class="store-info">
                <div class="alert alert-success">
                    <strong>âœ“ é–€å¸‚é¸æ“‡æˆåŠŸ!</strong>
                </div>
                <div class="info-row">
                    <div class="info-label">é–€å¸‚ä»£è™Ÿ:</div>
                    <div class="info-value" id="storeId">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">é–€å¸‚åç¨±:</div>
                    <div class="info-value" id="storeName">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">é–€å¸‚åœ°å€:</div>
                    <div class="info-value" id="storeAddress">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">é–€å¸‚é›»è©±:</div>
                    <div class="info-value" id="storePhone">-</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">4. å¾Œç«¯æ•´åˆç¯„ä¾‹</div>
                <div class="code-block" id="codeExample"></div>
            </div>
        </div>
    </div>

    <script>
        // ç”Ÿæˆå”¯ä¸€è¨‚å–®ç·¨è™Ÿ
        function generateOrderNo() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `ORD${timestamp}${random}`;
        }

        // åˆå§‹åŒ–è¨‚å–®ç·¨è™Ÿ
        document.getElementById('orderNo').value = generateOrderNo();

        // é–‹å•Ÿé–€å¸‚åœ°åœ–
        function openStoreMap() {
            const provider = document.getElementById('provider').value;
            const storeType = document.getElementById('storeType').value;
            const orderNo = document.getElementById('orderNo').value;

            if (!orderNo) {
                alert('è«‹è¼¸å…¥è¨‚å–®ç·¨è™Ÿ');
                return;
            }

            // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­,é€™è£¡æœƒå‘¼å«å¾Œç«¯ API å–å¾—é–€å¸‚åœ°åœ–è¡¨å–®
            // ç„¶å¾Œé–‹å•Ÿæ–°è¦–çª—é¡¯ç¤ºé–€å¸‚åœ°åœ–

            // æ¨¡æ“¬é–€å¸‚é¸æ“‡
            simulateStoreSelection();

            // æ›´æ–°ç¨‹å¼ç¢¼ç¯„ä¾‹
            updateCodeExample(provider, storeType, orderNo);
        }

        // æ¨¡æ“¬é–€å¸‚é¸æ“‡ (å¯¦éš›ä¸Šæœƒå¾å›å‘¼å–å¾—)
        function simulateStoreSelection() {
            setTimeout(() => {
                const storeType = document.getElementById('storeType').value;
                const mockStores = {
                    'UNIMART': {
                        id: '991182',
                        name: 'çµ±ä¸€è¶…å•† ä¿¡ç¾©é–€å¸‚',
                        address: 'å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ',
                        phone: '02-2723-4567'
                    },
                    'FAMI': {
                        id: '001779',
                        name: 'å…¨å®¶ä¾¿åˆ©å•†åº— å°åŒ—ä¿¡ç¾©åº—',
                        address: 'å°åŒ—å¸‚ä¿¡ç¾©å€æ¾ä»è·¯100è™Ÿ',
                        phone: '02-2723-8901'
                    },
                    'HILIFE': {
                        id: '001234',
                        name: 'èŠçˆ¾å¯Œ ä¿¡ç¾©é–€å¸‚',
                        address: 'å°åŒ—å¸‚ä¿¡ç¾©å€åŸºéš†è·¯ä¸€æ®µ200è™Ÿ',
                        phone: '02-2723-5678'
                    },
                    'OKMART': {
                        id: '100456',
                        name: 'OK ä¾¿åˆ©å•†åº— ä¿¡ç¾©åº—',
                        address: 'å°åŒ—å¸‚ä¿¡ç¾©å€æ¾å£½è·¯18è™Ÿ',
                        phone: '02-2723-6789'
                    }
                };

                const selectedStore = mockStores[storeType];

                document.getElementById('storeId').textContent = selectedStore.id;
                document.getElementById('storeName').textContent = selectedStore.name;
                document.getElementById('storeAddress').textContent = selectedStore.address;
                document.getElementById('storePhone').textContent = selectedStore.phone;

                document.getElementById('storeInfo').classList.add('active');
            }, 1000);
        }

        // æ›´æ–°ç¨‹å¼ç¢¼ç¯„ä¾‹
        function updateCodeExample(provider, storeType, orderNo) {
            const examples = {
                ecpay: `# ECPay ç¶ ç•Œç‰©æµ - é–€å¸‚åœ°åœ–æ•´åˆ

from ecpay_logistics import ECPayLogisticsService

# 1. åˆå§‹åŒ–æœå‹™
service = ECPayLogisticsService(
    merchant_id='YOUR_MERCHANT_ID',
    hash_key='YOUR_HASH_KEY',
    hash_iv='YOUR_HASH_IV',
    is_test=True
)

# 2. å–å¾—é–€å¸‚åœ°åœ– HTML
map_html = service.get_cvs_map(StoreMapData(
    merchant_trade_no='${orderNo}',
    logistics_sub_type='${storeType}',
    is_collection='Y',
    server_reply_url='https://your-domain.com/api/logistics/map-callback'
))

# 3. å›å‚³ HTML çµ¦å‰ç«¯ (é–‹å•Ÿæ–°è¦–çª—)
return {'html': map_html}

# 4. è™•ç†é–€å¸‚é¸æ“‡å›å‘¼
@app.post('/api/logistics/map-callback')
def handle_map_callback(request):
    store_id = request.form.get('CVSStoreID')
    store_name = request.form.get('CVSStoreName')
    store_address = request.form.get('CVSAddress')
    store_phone = request.form.get('CVSTelephone')

    # å„²å­˜é–€å¸‚è³‡è¨Šåˆ°è¨‚å–®
    update_order_store_info(
        order_no='${orderNo}',
        store_id=store_id,
        store_name=store_name
    )

    return '1|OK'  # å›æ‡‰æˆåŠŸ`,

                newebpay: `# NewebPay è—æ–°ç‰©æµ - é–€å¸‚åœ°åœ–æ•´åˆ

from newebpay_logistics import NewebPayLogisticsService

# 1. åˆå§‹åŒ–æœå‹™
service = NewebPayLogisticsService(
    merchant_id='YOUR_MERCHANT_ID',
    hash_key='YOUR_HASH_KEY',
    hash_iv='YOUR_HASH_IV',
    is_test=True
)

# 2. å–å¾—é–€å¸‚åœ°åœ– HTML
map_html = service.get_store_map(StoreMapData(
    merchant_order_no='${orderNo}',
    logistics_type='C2C',
    store_type='${storeType === 'UNIMART' ? '1' : storeType === 'FAMI' ? '2' : storeType === 'HILIFE' ? '3' : '4'}',
    return_url='https://your-domain.com/api/logistics/map-callback'
))

# 3. å›å‚³ HTML çµ¦å‰ç«¯
return {'html': map_html}

# 4. è™•ç†é–€å¸‚é¸æ“‡å›å‘¼
@app.post('/api/logistics/map-callback')
def handle_map_callback(request):
    # NewebPay å›å‚³åŠ å¯†è³‡æ–™,éœ€å…ˆè§£å¯†
    encrypt_data = request.form.get('EncryptData_')
    hash_data = request.form.get('HashData_')

    # é©—è­‰ä¸¦è§£å¯†
    if service.verify_callback(encrypt_data, hash_data):
        data = service.decrypt(encrypt_data)
        store_id = data.get('StoreID')
        store_name = data.get('StoreName')

        # å„²å­˜é–€å¸‚è³‡è¨Š
        update_order_store_info('${orderNo}', store_id, store_name)

    return '1|OK'`,

                payuni: `# PAYUNi çµ±ä¸€ç‰©æµ - é–€å¸‚åœ°åœ–æ•´åˆ

from payuni_logistics import PAYUNiLogisticsService

# 1. åˆå§‹åŒ–æœå‹™
service = PAYUNiLogisticsService(
    merchant_id='YOUR_MERCHANT_ID',
    hash_key='YOUR_HASH_KEY',
    hash_iv='YOUR_HASH_IV',
    is_test=True
)

# 2. å–å¾—é–€å¸‚åœ°åœ– URL (PAYUNi ä½¿ç”¨ RESTful API)
map_url = service.get_store_map_url(
    merchant_trade_no='${orderNo}',
    logistics_type='PAYUNi_Logistic_711',
    callback_url='https://your-domain.com/api/logistics/map-callback'
)

# 3. å›å‚³ URL çµ¦å‰ç«¯ (é‡å®šå‘åˆ°é–€å¸‚åœ°åœ–)
return {'url': map_url}

# 4. è™•ç†é–€å¸‚é¸æ“‡å›å‘¼
@app.post('/api/logistics/map-callback')
def handle_map_callback(request):
    # PAYUNi å›å‚³ JSON
    data = request.json

    store_id = data.get('ReceiverStoreID')
    store_name = data.get('ReceiverStoreName')
    store_address = data.get('ReceiverStoreAddress')

    # å„²å­˜é–€å¸‚è³‡è¨Š
    update_order_store_info(
        order_no='${orderNo}',
        store_id=store_id,
        store_name=store_name,
        store_address=store_address
    )

    return {'status': 'SUCCESS'}`
            };

            document.getElementById('codeExample').textContent = examples[provider];
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            document.getElementById('orderNo').value = generateOrderNo();
            document.getElementById('amount').value = '1200';
            document.getElementById('storeInfo').classList.remove('active');
            document.getElementById('codeExample').textContent = '';
        }

        // åˆå§‹åŒ–ç¨‹å¼ç¢¼ç¯„ä¾‹
        updateCodeExample('ecpay', 'UNIMART', document.getElementById('orderNo').value);

        // ç›£è½æœå‹™å•†è®Šæ›´
        document.getElementById('provider').addEventListener('change', function() {
            const provider = this.value;
            const storeType = document.getElementById('storeType').value;
            const orderNo = document.getElementById('orderNo').value;
            updateCodeExample(provider, storeType, orderNo);
        });
    </script>
</body>
</html>
